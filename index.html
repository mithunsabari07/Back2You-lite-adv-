<!DOCTYPE html>
<html lang="en">
<head>
    <title>Back2You - College Lost & Found Platform</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="College campus lost and found platform for students and staff.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        /* Modern CSS Variables */
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            --danger-gradient: linear-gradient(135deg, #ff0844 0%, #ffb199 100%);
            --primary-color: #5a67d8;
            --primary-dark: #4c51bf;
            --secondary-color: #38b2ac;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --danger-color: #f56565;
            --light-bg: #f7fafc;
            --card-bg: #ffffff;
            --dark-bg: #1a202c;
            --dark-card: #2d3748;
            --text-color: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --border-radius-sm: 8px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
            --shadow-inner: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dark Theme */
        .dark-mode {
            --light-bg: #1a202c;
            --card-bg: #2d3748;
            --dark-card: #4a5568;
            --text-color: #f7fafc;
            --text-light: #cbd5e0;
            --border-color: #4a5568;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition-slow);
            min-height: 100vh;
        }

        /* ===== LOGIN PAGE STYLES ===== */
        #loginPage {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            width: 100%;
            max-width: 420px;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            transition: var(--transition-slow);
        }

        .login-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .login-header i {
            font-size: 3.5rem;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 25px;
            border-radius: 50%;
            display: inline-block;
        }

        .login-header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .login-header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .tabs {
            display: flex;
            background: #f7fafc;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            padding: 18px;
            border: none;
            background: transparent;
            font-weight: 600;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .tab-btn.active {
            background: var(--card-bg);
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 35px 30px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 22px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 16px 18px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
            background: var(--light-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            background: var(--card-bg);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }

        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(90, 103, 216, 0.25);
        }

        .btn-secondary {
            background: var(--light-bg);
            color: var(--text-light);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
            border-color: var(--text-light);
        }

        .message {
            padding: 14px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
            text-align: center;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .message.success {
            background: rgba(72, 187, 120, 0.1);
            color: #2f855a;
            border: 1px solid rgba(72, 187, 120, 0.3);
        }

        .message.error {
            background: rgba(245, 101, 101, 0.1);
            color: #c53030;
            border: 1px solid rgba(245, 101, 101, 0.3);
        }

        .info {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .info a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .info a:hover {
            text-decoration: underline;
        }

        /* ===== APP PAGE STYLES ===== */
        #appPage {
            display: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header & Navigation - FIXED STICKY HEADER */
        header {
            background: var(--primary-gradient);
            color: white;
            padding: 1.2rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        /* Smaller header when scrolling */
        header.small-header {
            padding: 0.5rem 0;
        }

        header.small-header .logo h1 {
            font-size: 1.5rem;
        }

        header.small-header .logo p {
            font-size: 0.8rem;
            opacity: 0.8;
        }

        header.small-header .user-welcome {
            font-size: 0.85rem;
            padding: 6px 12px;
        }

        header.small-header .logout-btn {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo i {
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
            transition: var(--transition);
        }

        .logo p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
            transition: var(--transition);
        }

        /* User Profile in Header */
        .user-profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-welcome {
            font-weight: 600;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: var(--transition);
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        /* Dark Mode Toggle Button */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
        }

        .dark-mode-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            font-size: 1.2rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .dark-mode-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(30deg);
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon.lost {
            background: var(--warning-gradient);
        }

        .stat-icon.found {
            background: var(--success-gradient);
        }

        .stat-icon.matched {
            background: var(--secondary-gradient);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            margin: 0;
        }

        .stat-info p {
            color: var(--text-light);
            margin: 0;
            font-size: 0.9rem;
        }

        /* Navigation */
        .nav-tabs {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 10px;
            margin: 20px 0;
            display: flex;
            gap: 10px;
            box-shadow: var(--shadow);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: var(--text-light);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: var(--light-bg);
            color: var(--text-color);
        }

        .nav-tab.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: var(--shadow);
        }

        /* Report Forms */
        .report-forms {
            margin: 30px 0;
        }

        .form-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form-section.active {
            display: block;
        }

        .form-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 40px;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .form-card.lost-form {
            border-top: 4px solid var(--warning-color);
        }

        .form-card.found-form {
            border-top: 4px solid var(--success-color);
        }

        .form-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .form-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .form-header p {
            color: var(--text-light);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Form Elements */
        .form-grid {
            display: grid;
            gap: 25px;
        }

        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-label .required {
            color: var(--danger-color);
            margin-left: 4px;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            transition: var(--transition);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(90, 103, 216, 0.1);
        }

        .form-control::placeholder {
            color: var(--text-light);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        select.form-control {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23718096' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 16px;
            padding-right: 50px;
        }

        /* Form Steps */
        .form-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .form-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border-color);
            z-index: 1;
        }

        .form-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
            cursor: pointer;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-bg);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 10px;
            transition: var(--transition);
        }

        .form-step.active .step-number {
            background: var(--primary-gradient);
            border-color: var(--primary-color);
            color: white;
        }

        .form-step.completed .step-number {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .step-label {
            font-size: 0.9rem;
            color: var(--text-light);
            text-align: center;
        }

        .form-step.active .step-label {
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Form Pages */
        .form-page {
            display: none;
            animation: slideIn 0.3s ease;
        }

        .form-page.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Buttons */
        .btn {
            padding: 16px 32px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(90, 103, 216, 0.2);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
        }

        .btn-warning {
            background: var(--warning-gradient);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--light-bg);
        }

        .file-upload:hover {
            border-color: var(--primary-color);
            background: rgba(90, 103, 216, 0.05);
        }

        .file-upload i {
            font-size: 3rem;
            color: var(--text-light);
            margin-bottom: 15px;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload label {
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
            display: inline-block;
            margin: 10px 0;
        }

        .file-preview {
            margin-top: 20px;
            display: none;
        }

        .file-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: var(--border-radius-sm);
            object-fit: cover;
            border: 2px solid var(--border-color);
        }

        /* Image Grid */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-preview {
            position: relative;
            border-radius: var(--border-radius-sm);
            overflow: hidden;
            aspect-ratio: 1;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .image-preview:hover img {
            transform: scale(1.1);
        }

        .remove-image {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(245, 101, 101, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: var(--transition);
        }

        .image-preview:hover .remove-image {
            opacity: 1;
        }

        /* Found Item Details */
        .found-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .detail-card {
            background: var(--light-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .detail-card h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        /* Toggle Sections */
        .toggle-section {
            margin: 30px 0;
        }

        .toggle-header {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--border-color);
        }

        .toggle-header:hover {
            background: var(--light-bg);
        }

        .toggle-header.active {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
        }

        .toggle-content {
            background: var(--card-bg);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow);
            display: none;
            border: 1px solid var(--border-color);
            border-top: none;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .toggle-content.active {
            display: block;
            max-height: 2000px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toggle-icon {
            transition: var(--transition);
        }

        /* Items List */
        .items-list {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            border-left: 4px solid;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .item-card.lost {
            border-left-color: var(--warning-color);
        }

        .item-card.found {
            border-left-color: var(--success-color);
        }

        .item-card.matched {
            border-left-color: var(--primary-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .item-title {
            font-weight: 600;
            font-size: 1.2rem;
            margin: 0;
        }

        .item-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-lost {
            background: rgba(237, 137, 54, 0.1);
            color: var(--warning-color);
        }

        .badge-found {
            background: rgba(56, 178, 172, 0.1);
            color: var(--success-color);
        }

        .badge-matched {
            background: rgba(90, 103, 216, 0.1);
            color: var(--primary-color);
        }

        .owner-badge {
            background: rgba(72, 187, 120, 0.1);
            color: var(--success-color);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin-left: 8px;
            font-weight: 600;
        }

        .item-meta {
            display: flex;
            gap: 15px;
            margin: 10px 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .item-meta i {
            margin-right: 5px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .item-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--border-radius-sm);
            margin: 15px 0;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
        }

        /* Search & Filter */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 16px 50px 16px 50px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background: var(--card-bg);
            color: var(--text-color);
        }

        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            background: transparent;
            border-radius: var(--border-radius-sm);
            color: var(--text-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Enhanced Search Suggestions */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .search-suggestion-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-suggestion-item:hover {
            background: var(--light-bg);
        }

        .search-suggestion-item:last-child {
            border-bottom: none;
        }

        .highlight {
            background-color: #ffeb3b;
            color: #000;
            padding: 2px 0;
        }

        .search-suggestion-item .item-icon {
            font-size: 0.9rem;
            color: var(--primary-color);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .modal-title {
            font-size: 1.5rem;
            margin: 0;
        }

        .modal-close {
            background: transparent;
            border: none;
            font-size: 1.5rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--text-color);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 3000;
        }

        .toast {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid;
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left-color: var(--success-color);
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        .toast.info {
            border-left-color: var(--primary-color);
        }

        .toast-icon {
            font-size: 1.5rem;
        }

        .toast.success .toast-icon {
            color: var(--success-color);
        }

        .toast.error .toast-icon {
            color: var(--danger-color);
        }

        .toast.info .toast-icon {
            color: var(--primary-color);
        }

        .toast-message {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .toast-close {
            background: transparent;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Loading Spinner */
        .spinner-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Footer */
        footer {
            background: var(--card-bg);
            padding: 40px 0;
            margin-top: 60px;
            border-top: 1px solid var(--border-color);
        }

        .footer-content {
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--text-light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-link:hover {
            color: var(--primary-color);
        }

        .copyright {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 10px;
        }

        .team-name {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 5px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .form-card {
                padding: 20px;
            }

            .form-steps {
                flex-wrap: wrap;
                gap: 20px;
            }

            .form-steps::before {
                display: none;
            }

            .modal-content {
                padding: 20px;
            }

            .stats-bar {
                grid-template-columns: 1fr;
            }

            .dark-mode-toggle {
                top: 10px;
                right: 10px;
            }

            .dark-mode-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 10px;
            }

            .user-profile-header {
                flex-direction: column;
                gap: 10px;
                align-items: center;
            }

            .user-welcome {
                font-size: 0.8rem;
                padding: 6px 12px;
            }

            .login-container {
                max-width: 100%;
                border-radius: 12px;
            }

            .login-header {
                padding: 30px 20px;
            }

            .login-header i {
                font-size: 2.8rem;
                padding: 20px;
            }

            .login-header h1 {
                font-size: 1.8rem;
            }

            .tab-content {
                padding: 25px 20px;
            }

            .tab-btn {
                padding: 15px;
                font-size: 0.95rem;
            }

            /* Small header adjustments for mobile */
            header.small-header .logo h1 {
                font-size: 1.3rem;
            }

            header.small-header .logo i {
                font-size: 1.5rem;
                padding: 8px;
            }

            header.small-header .user-profile-header {
                flex-direction: row;
                gap: 8px;
            }

            .search-suggestions {
                max-height: 200px;
            }
        }

        @media (max-width: 480px) {
            .footer-links {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- LOGIN PAGE -->
    <div id="loginPage">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-search-location"></i>
                <h1>Back2You</h1>
                <p>College Lost & Found Platform</p>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('login')">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="tab-btn" onclick="showTab('register')">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>

            <!-- Login Tab -->
            <div id="loginTab" class="tab-content active">
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="loginUsername" required 
                               placeholder="Enter your username" autocomplete="username">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" required 
                               placeholder="Enter your password" autocomplete="current-password">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>

                    <div class="info">
                        Don't have an account? <a href="#" onclick="showTab('register')">Register here</a>
                    </div>
                </form>
            </div>

            <!-- Register Tab -->
            <div id="registerTab" class="tab-content">
                <form id="registerForm" onsubmit="handleRegister(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-control" id="regName" required 
                               placeholder="Your full name">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" id="regUsername" required 
                               placeholder="Choose a username">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email <span class="required">*</span></label>
                        <input type="email" class="form-control" id="regEmail" required
                               placeholder="Your college email address">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phone Number (Optional)</label>
                        <input type="tel" class="form-control" id="regPhone"
                               placeholder="Your phone number">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" id="regPassword" required minlength="6"
                               placeholder="At least 6 characters">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" class="form-control" id="regConfirmPassword" required
                               placeholder="Confirm your password">
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>

                    <div class="info">
                        Already have an account? <a href="#" onclick="showTab('login')">Login here</a>
                    </div>
                </form>
            </div>

            <div id="message" class="message"></div>
        </div>
    </div>

    <!-- MAIN APP PAGE -->
    <div id="appPage">
        <!-- Dark Mode Toggle Button -->
        <div class="dark-mode-toggle">
            <button class="dark-mode-btn" onclick="toggleDarkMode()" aria-label="Toggle Dark Mode" title="Toggle Dark Mode">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Header -->
        <header id="mainHeader">
            <div class="container header-content">
                <div class="logo">
                    <i class="fas fa-search-location"></i>
                    <div>
                        <h1>Back2You</h1>
                        <p>College Lost & Found Platform</p>
                    </div>
                </div>
                <div class="header-controls">
                    <!-- User Profile -->
                    <div id="userProfileHeader" class="user-profile-header">
                        <span id="userWelcome" class="user-welcome"></span>
                        <button onclick="logout()" class="logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>

                    <button class="btn btn-primary" onclick="showQuickGuide()">
                        <i class="fas fa-question-circle"></i> Quick Guide
                    </button>
                </div>
            </div>
        </header>

        <!-- Stats Bar -->
        <div class="container stats-bar">
            <div class="stat-card" onclick="scrollToSection('lostContainer')">
                <div class="stat-icon lost">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="lostCount">0</h3>
                    <p>Lost Items</p>
                </div>
            </div>
            <div class="stat-card" onclick="scrollToSection('foundContainer')">
                <div class="stat-icon found">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3 id="foundCount">0</h3>
                    <p>Found Items</p>
                </div>
            </div>
            <div class="stat-card" onclick="scrollToSection('matchedContainer')">
                <div class="stat-icon matched">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="stat-info">
                    <h3 id="matchedCount">0</h3>
                    <p>Successful Matches</p>
                </div>
            </div>
        </div>

        <!-- Report Forms Navigation -->
        <div class="container">
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showReportForm('lost')">
                    <i class="fas fa-exclamation-triangle"></i>
                    Report Lost Item
                </button>
                <button class="nav-tab" onclick="showReportForm('found')">
                    <i class="fas fa-check-circle"></i>
                    Report Found Item
                </button>
            </div>
        </div>

        <!-- Report Forms -->
        <div class="container report-forms">
            <!-- Lost Item Form -->
            <div id="lostFormSection" class="form-section active">
                <div class="form-card lost-form">
                    <div class="form-header">
                        <h2><i class="fas fa-exclamation-triangle"></i> Report a Lost Item</h2>
                        <p>Help us reunite you with your lost belongings by providing detailed information below.</p>
                    </div>

                    <form id="lostForm" onsubmit="handleLostFormSubmit(event)">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" for="lName">
                                    <i class="fas fa-user"></i> Your Full Name
                                    <span class="required">*</span>
                                </label>
                                <input class="form-control" id="lName" type="text" required 
                                       placeholder="Enter your full name">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lEmail">
                                    <i class="fas fa-envelope"></i> Email Address
                                    <span class="required">*</span>
                                </label>
                                <input class="form-control" id="lEmail" type="email" required 
                                       placeholder="Your email address">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lPhone">
                                    <i class="fas fa-phone"></i> Phone Number (Optional)
                                </label>
                                <input class="form-control" id="lPhone" type="tel" 
                                       placeholder="Your phone number">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lItem">
                                    <i class="fas fa-box"></i> Item Name
                                    <span class="required">*</span>
                                </label>
                                <input class="form-control" id="lItem" type="text" required 
                                       placeholder="e.g., Laptop, ID Card, Keys, Calculator">
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lCategory">
                                    <i class="fas fa-tag"></i> Category
                                    <span class="required">*</span>
                                </label>
                                <select class="form-control" id="lCategory" required>
                                    <option value="">Select a category</option>
                                    <option value="electronics">üì± Electronics</option>
                                    <option value="documents">üìÑ Documents/ID Cards</option>
                                    <option value="stationery">‚úèÔ∏è Stationery</option>
                                    <option value="clothing">üëï Clothing</option>
                                    <option value="keys">üîë Keys</option>
                                    <option value="bag">üéí Bag/Backpack</option>
                                    <option value="books">üìö Books/Notebooks</option>
                                    <option value="other">üì¶ Other</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lDate">
                                    <i class="fas fa-calendar"></i> Date Lost
                                    <span class="required">*</span>
                                </label>
                                <input class="form-control" id="lDate" type="date" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="lTime">
                                    <i class="fas fa-clock"></i> Approximate Time
                                </label>
                                <input class="form-control" id="lTime" type="time">
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label" for="lLoc">
                                    <i class="fas fa-map-marker-alt"></i> Location Where Lost
                                </label>
                                <input class="form-control" id="lLoc" type="text" 
                                       placeholder="e.g., Physics Lab, Library, Cafeteria, Classroom A">
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label" for="lDesc">
                                    <i class="fas fa-align-left"></i> Detailed Description
                                    <span class="required">*</span>
                                </label>
                                <textarea class="form-control" id="lDesc" rows="4" required
                                          placeholder="Provide detailed description including:
        ‚Ä¢ Color, size, and brand
        ‚Ä¢ Distinctive features or marks
        ‚Ä¢ Contents (if bag/wallet)
        ‚Ä¢ Serial number (if electronics)"></textarea>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label">
                                    <i class="fas fa-images"></i> Upload Reference Photos (Optional)
                                </label>
                                <div class="file-upload" onclick="document.getElementById('lImage').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload reference photos</p>
                                    <label>Choose Files</label>
                                    <p class="small-text">Max file size: 5MB. Supported: JPG, PNG, GIF</p>
                                    <input id="lImage" type="file" accept="image/*" multiple 
                                           onchange="handleLostImageUpload(event)">
                                </div>
                                <div id="lostImagePreview" class="image-grid"></div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="reset" class="btn btn-outline">
                                <i class="fas fa-redo"></i> Clear Form
                            </button>
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-paper-plane"></i> Report Lost Item
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Found Item Form -->
            <div id="foundFormSection" class="form-section">
                <div class="form-card found-form">
                    <div class="form-header">
                        <h2><i class="fas fa-check-circle"></i> Report a Found Item</h2>
                        <p>Help reunite lost items with their owners by providing detailed information below.</p>
                    </div>

                    <!-- Form Steps -->
                    <div class="form-steps">
                        <div class="form-step active" onclick="goToStep(1)">
                            <div class="step-number">1</div>
                            <div class="step-label">Basic Info</div>
                        </div>
                        <div class="form-step" onclick="goToStep(2)">
                            <div class="step-number">2</div>
                            <div class="step-label">Item Details</div>
                        </div>
                        <div class="form-step" onclick="goToStep(3)">
                            <div class="step-number">3</div>
                            <div class="step-label">Photos & Contact</div>
                        </div>
                    </div>

                    <!-- Multi-step Form -->
                    <form id="foundForm" onsubmit="handleFoundFormSubmit(event)">
                        <!-- Step 1: Basic Information -->
                        <div id="foundStep1" class="form-page active">
                            <div class="found-details-grid">
                                <div class="detail-card">
                                    <h4><i class="fas fa-user-circle"></i> About You</h4>
                                    <div class="form-group">
                                        <label class="form-label" for="fName">
                                            Your Name
                                            <span class="required">*</span>
                                        </label>
                                        <input class="form-control" id="fName" type="text" required 
                                               placeholder="Enter your full name">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fEmail">
                                            Email Address
                                            <span class="required">*</span>
                                        </label>
                                        <input class="form-control" id="fEmail" type="email" required 
                                               placeholder="Your email address">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fPhone">
                                            Phone Number (Optional)
                                        </label>
                                        <input class="form-control" id="fPhone" type="tel" 
                                               placeholder="Your phone number">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fOrganization">
                                            Department/Role (Optional)
                                        </label>
                                        <input class="form-control" id="fOrganization" type="text" 
                                               placeholder="e.g., Computer Science, Faculty, Student">
                                    </div>
                                </div>

                                <div class="detail-card">
                                    <h4><i class="fas fa-map-marker-alt"></i> Location Details</h4>
                                    <div class="form-group">
                                        <label class="form-label" for="fDate">
                                            Date Found
                                            <span class="required">*</span>
                                        </label>
                                        <input class="form-control" id="fDate" type="date" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fTime">
                                            Time Found
                                        </label>
                                        <input class="form-control" id="fTime" type="time">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fLoc">
                                            Location Found
                                            <span class="required">*</span>
                                        </label>
                                        <input class="form-control" id="fLoc" type="text" required
                                               placeholder="e.g., Computer Lab, Library, Main Building, Cafeteria">
                                    </div>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="goToStep(2)">
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Item Details -->
                        <div id="foundStep2" class="form-page">
                            <div class="found-details-grid">
                                <div class="detail-card">
                                    <h4><i class="fas fa-box-open"></i> Item Information</h4>
                                    <div class="form-group">
                                        <label class="form-label" for="fItem">
                                            What did you find?
                                            <span class="required">*</span>
                                        </label>
                                        <input class="form-control" id="fItem" type="text" required 
                                               placeholder="Describe the item">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fCategory">
                                            Category
                                            <span class="required">*</span>
                                        </label>
                                        <select class="form-control" id="fCategory" required>
                                            <option value="">Select a category</option>
                                            <option value="electronics">üì± Electronics</option>
                                            <option value="documents">üìÑ Documents/ID Cards</option>
                                            <option value="stationery">‚úèÔ∏è Stationery</option>
                                            <option value="clothing">üëï Clothing</option>
                                            <option value="keys">üîë Keys</option>
                                            <option value="bag">üéí Bag/Backpack</option>
                                            <option value="books">üìö Books/Notebooks</option>
                                            <option value="other">üì¶ Other</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fCondition">
                                            Item Condition
                                        </label>
                                        <select class="form-control" id="fCondition">
                                            <option value="">Select condition</option>
                                            <option value="new">New/Like New</option>
                                            <option value="good">Good</option>
                                            <option value="fair">Fair/Used</option>
                                            <option value="damaged">Damaged</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="detail-card">
                                    <h4><i class="fas fa-clipboard-list"></i> Additional Details</h4>
                                    <div class="form-group">
                                        <label class="form-label" for="fColor">
                                            Color
                                        </label>
                                        <input class="form-control" id="fColor" type="text" 
                                               placeholder="e.g., Black, Blue, Red">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fBrand">
                                            Brand/Manufacturer
                                        </label>
                                        <input class="form-control" id="fBrand" type="text" 
                                               placeholder="e.g., Dell, HP, Samsung">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fModel">
                                            Model/ID Number
                                        </label>
                                        <input class="form-control" id="fModel" type="text" 
                                               placeholder="If visible/applicable">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label" for="fDesc">
                                    <i class="fas fa-align-left"></i> Detailed Description
                                    <span class="required">*</span>
                                </label>
                                <textarea class="form-control" id="fDesc" rows="4" required
                                          placeholder="Provide detailed description including:
        ‚Ä¢ Distinctive features or marks
        ‚Ä¢ Contents found inside (if any)
        ‚Ä¢ Any identifiers (student ID, name)
        ‚Ä¢ State of the item"></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="goToStep(1)">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button type="button" class="btn btn-outline" onclick="goToStep(3)">
                                    Next <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Photos & Contact -->
                        <div id="foundStep3" class="form-page">
                            <div class="found-details-grid">
                                <div class="detail-card">
                                    <h4><i class="fas fa-camera"></i> Item Photos</h4>
                                    <p class="small-text">Clear photos help owners identify their items faster.</p>

                                    <div class="file-upload" onclick="document.getElementById('fImage').click()">
                                        <i class="fas fa-camera"></i>
                                        <p>Click to upload clear photos</p>
                                        <label>Choose Files</label>
                                        <p class="small-text">Max 5 photos, 5MB each. JPG, PNG</p>
                                        <input id="fImage" type="file" accept="image/*" multiple 
                                               onchange="handleFoundImageUpload(event)">
                                    </div>

                                    <div id="foundImagePreview" class="image-grid"></div>
                                </div>

                                <div class="detail-card">
                                    <h4><i class="fas fa-hand-holding-heart"></i> Safe Keeping</h4>
                                    <div class="form-group">
                                        <label class="form-label" for="fStorage">
                                            Current Storage Location
                                        </label>
                                        <select class="form-control" id="fStorage">
                                            <option value="">Where is it kept?</option>
                                            <option value="myself">With me (I'll keep it safe)</option>
                                            <option value="office">College Office</option>
                                            <option value="staffroom">Staff Room</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label" for="fAvailability">
                                            When are you available?
                                        </label>
                                        <input class="form-control" id="fAvailability" type="text" 
                                               placeholder="e.g., Weekdays 9-5, Anytime">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">
                                            <input type="checkbox" id="fAnonymous">
                                            Report anonymously
                                        </label>
                                        <small class="form-text">Your contact will be shared only with the owner</small>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group full-width">
                                <label class="form-label" for="fNotes">
                                    <i class="fas fa-sticky-note"></i> Additional Notes (Optional)
                                </label>
                                <textarea class="form-control" id="fNotes" rows="3"
                                          placeholder="Any additional information that might help the owner identify the item..."></textarea>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" onclick="goToStep(2)">
                                    <i class="fas fa-arrow-left"></i> Back
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-paper-plane"></i> Submit Found Report
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Browse Items Section -->
        <div class="container toggle-section">
            <div class="toggle-header" onclick="toggleSection('lostContainer')">
                <div>
                    <h3><i class="fas fa-exclamation-triangle"></i> Browse Lost Items</h3>
                    <p>Search for items reported as lost by students & staff</p>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div id="lostContainer" class="toggle-content">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input class="search-input" id="searchLost" type="text" 
                           placeholder="Search lost items by name, category, location..." 
                           oninput="debounceFilter('lost')">
                    <div id="lostSearchSuggestions" class="search-suggestions"></div>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterItems('lost', 'all')">All</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'electronics')">Electronics</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'documents')">Documents</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'stationery')">Stationery</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'keys')">Keys</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'books')">Books</button>
                    <button class="filter-btn" onclick="filterItems('lost', 'other')">Other</button>
                    <button class="filter-btn matched-filter" onclick="filterMatchedItems()">
                        <i class="fas fa-handshake"></i> Matched
                    </button>
                </div>
                <div id="lostList" class="items-list">
                    <div class="spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="container toggle-section">
            <div class="toggle-header" onclick="toggleSection('foundContainer')">
                <div>
                    <h3><i class="fas fa-check-circle"></i> Browse Found Items</h3>
                    <p>Search for items reported as found in campus</p>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div id="foundContainer" class="toggle-content">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input class="search-input" id="searchFound" type="text" 
                           placeholder="Search found items by name, category, location..." 
                           oninput="debounceFilter('found')">
                    <div id="foundSearchSuggestions" class="search-suggestions"></div>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterItems('found', 'all')">All</button>
                    <button class="filter-btn" onclick="filterItems('found', 'electronics')">Electronics</button>
                    <button class="filter-btn" onclick="filterItems('found', 'documents')">Documents</button>
                    <button class="filter-btn" onclick="filterItems('found', 'stationery')">Stationery</button>
                    <button class="filter-btn" onclick="filterItems('found', 'keys')">Keys</button>
                    <button class="filter-btn" onclick="filterItems('found', 'books')">Books</button>
                    <button class="filter-btn" onclick="filterItems('found', 'other')">Other</button>
                    <button class="filter-btn matched-filter" onclick="filterMatchedItems()">
                        <i class="fas fa-handshake"></i> Matched
                    </button>
                </div>
                <div id="foundList" class="items-list">
                    <div class="spinner-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- NEW: Successfully Matched Items Section -->
        <div class="container toggle-section">
            <div class="toggle-header" onclick="toggleSection('matchedContainer')">
                <div>
                    <h3><i class="fas fa-handshake"></i> Successfully Matched Items</h3>
                    <p>Items that have been successfully matched between owners and finders</p>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </div>
            <div id="matchedContainer" class="toggle-content">
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input class="search-input" id="searchMatched" type="text" 
                           placeholder="Search matched items by name, category, location..." 
                           oninput="debounceFilter('matched')">
                    <div id="matchedSearchSuggestions" class="search-suggestions"></div>
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" onclick="filterItems('matched', 'all')">All</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'electronics')">Electronics</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'documents')">Documents</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'stationery')">Stationery</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'keys')">Keys</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'books')">Books</button>
                    <button class="filter-btn" onclick="filterItems('matched', 'other')">Other</button>
                </div>
                <div id="matchedList" class="items-list">
                    <div class="empty-state">
                        <i class="fas fa-handshake"></i>
                        <h3>No matched items yet</h3>
                        <p>When someone claims an item, it will appear here</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title"><i class="fas fa-edit"></i> Edit Item</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <form id="editForm" onsubmit="handleEditSubmit(event)">
                    <div class="form-group">
                        <label class="form-label">Item Name</label>
                        <input class="form-control" id="editItem" type="text" required>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Category</label>
                            <select class="form-control" id="editCategory" required>
                                <option value="electronics">Electronics</option>
                                <option value="documents">Documents/ID Cards</option>
                                <option value="stationery">Stationery</option>
                                <option value="clothing">Clothing</option>
                                <option value="keys">Keys</option>
                                <option value="bag">Bag/Backpack</option>
                                <option value="books">Books/Notebooks</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input class="form-control" id="editDate" type="date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Location</label>
                        <input class="form-control" id="editLocation" type="text" required 
                               placeholder="e.g., Physics Lab, Library, Cafeteria">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input class="form-control" id="editEmail" type="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone (Optional)</label>
                        <input class="form-control" id="editPhone" type="tel">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="editDesc" rows="3"></textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        <button type="button" class="btn btn-outline" onclick="closeModal()" style="flex: 1;">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Footer -->
        <footer>
            <div class="container footer-content">
                <div class="logo">
                    <i class="fas fa-search-location"></i>
                    <div>
                        <h2>Back2You</h2>
                        <p>College Lost & Found Platform</p>
                    </div>
                </div>
                <div class="footer-links">
                    <a href="#" class="footer-link" onclick="showQuickGuide()">How It Works</a>
                    <a href="#" class="footer-link" onclick="showPrivacyPolicy()">Privacy Policy</a>
                    <a href="#" class="footer-link" onclick="showContact()">Contact Us</a>
                    <a href="#" class="footer-link" onclick="showAbout()">About</a>
                </div>
                <div class="copyright">
                    &copy; 2026 Back2You. College Lost & Found Management System.
                </div>
                <div class="team-name">
                    Developed by <strong>Team Nexus</strong>
                </div>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration - UPDATED WITH YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDKy_RM1zrJS2Ux-mrf-ZSAFG3QJGSvm_c",
            authDomain: "back2you-lite-e6695.firebaseapp.com",
            databaseURL: "https://back2you-lite-e6695-default-rtdb.firebaseio.com",
            projectId: "back2you-lite-e6695",
            storageBucket: "back2you-lite-e6695.firebasestorage.app",
            messagingSenderId: "972873481520",
            appId: "1:972873481520:web:5004e6ca6ee0dde6511cf5",
            measurementId: "G-MJBDH1EP4N"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const storage = firebase.storage();
        const usersCollection = db.collection("users");

        // ===== EMAILJS CONFIGURATION =====
        // Initialize EmailJS with your public key
        emailjs.init("NF4lBdK5sNbLjoy-G"); // Your public key
        
        // EmailJS Service ID and Template ID - UPDATED WITH YOUR IDs
        const EMAILJS_SERVICE_ID = "service_w5u87xe"; // Your service ID
        const EMAILJS_TEMPLATE_ID = "template_w0vxz1x"; // Your template ID

        // ===== LOGIN/REGISTRATION FUNCTIONS =====
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            if (tabName === 'login') {
                document.getElementById('loginTab').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
            } else {
                document.getElementById('registerTab').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
            }

            clearMessage();
        }

        function showMessage(text, type = 'error') {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
        }

        function clearMessage() {
            const messageDiv = document.getElementById('message');
            messageDiv.style.display = 'none';
        }

        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function hashPassword(username, password) {
            return btoa(username + ':' + password + ':back2you_salt_2024');
        }

        async function handleRegister(event) {
            event.preventDefault();

            const name = document.getElementById('regName').value.trim();
            const username = document.getElementById('regUsername').value.trim().toLowerCase();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const phone = document.getElementById('regPhone').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            // Validation
            if (password !== confirmPassword) {
                showMessage('Passwords do not match!', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('Password must be at least 6 characters', 'error');
                return;
            }

            if (username.length < 3) {
                showMessage('Username must be at least 3 characters', 'error');
                return;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('Please enter a valid email address', 'error');
                return;
            }

            try {
                // Check if username exists
                const usernameCheck = await usersCollection.where("username", "==", username).get();
                if (!usernameCheck.empty) {
                    showMessage('Username already taken. Please choose another.', 'error');
                    return;
                }

                // Check if email exists
                const emailCheck = await usersCollection.where("email", "==", email).get();
                if (!emailCheck.empty) {
                    showMessage('Email already registered. Please use a different email.', 'error');
                    return;
                }

                // Create user object
                const userId = generateUserId();
                const userData = {
                    userId: userId,
                    name: name,
                    username: username,
                    email: email,
                    phone: phone || '',
                    passwordHash: hashPassword(username, password),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    role: 'user'
                };

                // Save to Firebase
                await usersCollection.add(userData);

                // Create session
                const sessionData = {
                    userId: userId,
                    name: name,
                    username: username,
                    email: email,
                    phone: phone || '',
                    loginTime: new Date().toISOString()
                };

                // Save to localStorage
                localStorage.setItem('back2you_user', JSON.stringify(sessionData));

                // Show success
                showMessage('Account created successfully! Loading app...', 'success');

                // Switch to app page after 1.5 seconds
                setTimeout(() => {
                    switchToApp(sessionData);
                }, 1500);

            } catch (error) {
                console.error('Registration error:', error);
                showMessage('Registration failed. Please try again.', 'error');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('loginUsername').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;

            try {
                // Find user by username
                const userSnapshot = await usersCollection.where("username", "==", username).get();

                if (userSnapshot.empty) {
                    showMessage('Username not found.', 'error');
                    return;
                }

                const userDoc = userSnapshot.docs[0];
                const userData = userDoc.data();

                // Verify password
                const hashedPassword = hashPassword(username, password);
                if (userData.passwordHash !== hashedPassword) {
                    showMessage('Incorrect password.', 'error');
                    return;
                }

                // Create session
                const sessionData = {
                    userId: userData.userId,
                    name: userData.name,
                    username: userData.username,
                    email: userData.email,
                    phone: userData.phone || '',
                    loginTime: new Date().toISOString()
                };

                // Save to localStorage
                localStorage.setItem('back2you_user', JSON.stringify(sessionData));

                // Show success
                showMessage(`Welcome back, ${userData.name}! Loading app...`, 'success');

                // Switch to app page after 1.5 seconds
                setTimeout(() => {
                    switchToApp(sessionData);
                }, 1500);

            } catch (error) {
                console.error('Login error:', error);
                showMessage('Login failed. Please try again.', 'error');
            }
        }

        function switchToApp(userData) {
            // Hide login page, show app page
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appPage').style.display = 'block';

            // Initialize app with user data
            initApp(userData);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('back2you_user');
                // Switch back to login page
                document.getElementById('appPage').style.display = 'none';
                document.getElementById('loginPage').style.display = 'flex';
                // Clear login form
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                showTab('login');
            }
        }

        // ===== APP INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is already logged in
            const userSession = localStorage.getItem('back2you_user');
            if (userSession) {
                try {
                    const userData = JSON.parse(userSession);
                    switchToApp(userData);
                } catch (error) {
                    console.error('Session error:', error);
                    localStorage.removeItem('back2you_user');
                }
            }
        });

        // ===== APP STATE =====
        let currentUser = null;
        let allItems = { lost: [], found: [], matched: [] };
        let currentEditId = null;
        let currentEditType = null;
        let debounceTimer;
        let stats = { lost: 0, found: 0, matched: 0 };
        let foundFormStep = 1;
        let lostImages = [];
        let foundImages = [];

        // ===== APP FUNCTIONS =====
        function initApp(userData) {
            currentUser = userData;
            updateUserUI();

            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('lDate').value = today;
            document.getElementById('fDate').value = today;

            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                updateDarkModeIcon();
            }

            // Set up form navigation
            setupFormNavigation();

            // Initialize empty states
            initializeEmptyStates();

            // Load items
            loadItems();

            // Initialize sticky header functionality
            initStickyHeader();

            // Initialize search suggestions
            initSearchSuggestions();
        }

        // ===== ENHANCED SEARCH FUNCTIONS =====
        function initSearchSuggestions() {
            // Add event listeners for search inputs
            document.getElementById('searchLost').addEventListener('focus', function() {
                showSearchSuggestions('lost', this.value);
            });
            document.getElementById('searchFound').addEventListener('focus', function() {
                showSearchSuggestions('found', this.value);
            });
            document.getElementById('searchMatched').addEventListener('focus', function() {
                showSearchSuggestions('matched', this.value);
            });

            // Close suggestions when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.search-container')) {
                    hideAllSearchSuggestions();
                }
            });
        }

        function showSearchSuggestions(type, searchTerm) {
            const suggestionsContainer = document.getElementById(`${type}SearchSuggestions`);
            const items = type === 'lost' ? allItems.lost : 
                         type === 'found' ? allItems.found : 
                         allItems.matched;

            if (!searchTerm) {
                hideAllSearchSuggestions();
                return;
            }

            const searchLower = searchTerm.toLowerCase();
            const suggestions = items.filter(item => {
                return item.item.toLowerCase().includes(searchLower) ||
                       (item.category && item.category.toLowerCase().includes(searchLower)) ||
                       (item.location && item.location.toLowerCase().includes(searchLower));
            }).slice(0, 10); // Limit to 10 suggestions

            if (suggestions.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            suggestionsContainer.innerHTML = suggestions.map(item => {
                const highlightedText = highlightText(item.item, searchTerm);
                return `
                    <div class="search-suggestion-item" onclick="selectSuggestion('${type}', '${item.id}')">
                        <i class="fas fa-${type === 'lost' ? 'exclamation-triangle' : type === 'found' ? 'check-circle' : 'handshake'} item-icon"></i>
                        <span>${highlightedText}</span>
                        <small style="margin-left: auto; color: var(--text-light);">
                            ${type === 'lost' ? 'Lost' : type === 'found' ? 'Found' : 'Matched'}
                        </small>
                    </div>
                `;
            }).join('');

            suggestionsContainer.style.display = 'block';
        }

        function highlightText(text, searchTerm) {
            if (!searchTerm) return escapeHtml(text);
            
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return escapeHtml(text).replace(regex, '<span class="highlight">$1</span>');
        }

        function selectSuggestion(type, itemId) {
            const items = type === 'lost' ? allItems.lost : 
                         type === 'found' ? allItems.found : 
                         allItems.matched;
            
            const item = items.find(i => i.id === itemId);
            if (!item) return;

            // Scroll to the item
            const itemElement = document.querySelector(`[data-id="${itemId}"]`);
            if (itemElement) {
                itemElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                itemElement.style.animation = 'pulse 1s 3';
                setTimeout(() => {
                    itemElement.style.animation = '';
                }, 3000);
            }

            hideAllSearchSuggestions();
            document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`).value = item.item;
        }

        function hideAllSearchSuggestions() {
            document.querySelectorAll('.search-suggestions').forEach(el => {
                el.style.display = 'none';
            });
        }

        // ===== STICKY HEADER FUNCTIONALITY =====
        function initStickyHeader() {
            const header = document.getElementById('mainHeader');
            let lastScrollTop = 0;
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > 100) {
                    header.classList.add('small-header');
                } else {
                    header.classList.remove('small-header');
                }
                
                lastScrollTop = scrollTop;
            });
        }

        function updateUserUI() {
            if (currentUser) {
                document.getElementById('userWelcome').textContent = `Welcome, ${currentUser.name}`;

                // Auto-fill forms with user data
                if (!document.getElementById('lName').value) {
                    document.getElementById('lName').value = currentUser.name;
                }
                if (!document.getElementById('lEmail').value) {
                    document.getElementById('lEmail').value = currentUser.email || '';
                }
                if (!document.getElementById('lPhone').value) {
                    document.getElementById('lPhone').value = currentUser.phone || '';
                }
                if (!document.getElementById('fName').value) {
                    document.getElementById('fName').value = currentUser.name;
                }
                if (!document.getElementById('fEmail').value) {
                    document.getElementById('fEmail').value = currentUser.email || '';
                }
                if (!document.getElementById('fPhone').value) {
                    document.getElementById('fPhone').value = currentUser.phone || '';
                }
            }
        }

        // ===== EMAIL NOTIFICATION FUNCTIONS =====
        async function sendNotificationEmail(toEmail, toName, itemDetails, claimerDetails, type) {
            try {
                // Prepare email template parameters
                const templateParams = {
                    to_email: toEmail,
                    to_name: toName,
                    from_name: claimerDetails.name,
                    from_email: claimerDetails.email,
                    from_phone: claimerDetails.phone || 'Not provided',
                    item_name: itemDetails.item,
                    item_type: type === 'lost' ? 'Lost Item' : 'Found Item',
                    item_description: itemDetails.description || 'No description provided',
                    item_location: itemDetails.location || 'Location not specified',
                    item_date: itemDetails.date || new Date().toLocaleDateString(),
                    message: `${claimerDetails.name} believes they have found your lost item. Please contact them to arrange the return.`
                };

                // Send email using EmailJS
                const response = await emailjs.send(
                    EMAILJS_SERVICE_ID,
                    EMAILJS_TEMPLATE_ID,
                    templateParams
                );

                console.log('Email sent successfully:', response);
                return true;
            } catch (error) {
                console.error('Failed to send email:', error);
                return false;
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;

            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };

            toast.innerHTML = `
                <i class="fas ${icons[type]} toast-icon"></i>
                <div class="toast-message">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div>${escapeHtml(message)}</div>
                </div>
                <button class="toast-close" onclick="removeToast('${toastId}')">&times;</button>
            `;

            container.appendChild(toast);

            setTimeout(() => removeToast(toastId), duration);
        }

        function removeToast(id) {
            const toast = document.getElementById(id);
            if (toast) {
                toast.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => toast.remove(), 300);
            }
        }

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
            updateDarkModeIcon();
            showToast('Dark mode ' + (document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled'), 'info');
        }

        function updateDarkModeIcon() {
            const icon = document.querySelector('.dark-mode-btn i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        // ===== FORM NAVIGATION =====
        function setupFormNavigation() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === '1') {
                    e.preventDefault();
                    showReportForm('lost');
                }
                if (e.ctrlKey && e.key === '2') {
                    e.preventDefault();
                    showReportForm('found');
                }
            });
        }

        function showReportForm(formType) {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab')[formType === 'lost' ? 0 : 1].classList.add('active');

            document.getElementById('lostFormSection').classList.toggle('active', formType === 'lost');
            document.getElementById('foundFormSection').classList.toggle('active', formType === 'found');

            if (formType === 'found') {
                goToStep(1);
            }
        }

        function goToStep(step) {
            document.querySelectorAll('.form-step').forEach((formStep, index) => {
                formStep.classList.remove('active');
                if (index + 1 < step) {
                    formStep.classList.add('completed');
                } else {
                    formStep.classList.remove('completed');
                }
            });
            document.querySelectorAll('.form-step')[step - 1].classList.add('active');

            document.querySelectorAll('.form-page').forEach((page, index) => {
                page.classList.toggle('active', index + 1 === step);
            });

            foundFormStep = step;
        }

        // ===== IMAGE HANDLING =====
        function handleLostImageUpload(event) {
            const files = Array.from(event.target.files);
            const previewContainer = document.getElementById('lostImagePreview');
            previewContainer.innerHTML = '';

            files.forEach((file, index) => {
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`File ${file.name} is too large (max 5MB)`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgSrc = e.target.result;
                    lostImages.push(imgSrc);

                    const preview = document.createElement('div');
                    preview.className = 'image-preview';
                    preview.innerHTML = `
                        <img src="${imgSrc}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-image" onclick="removeLostImage(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    previewContainer.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });
        }

        function handleFoundImageUpload(event) {
            const files = Array.from(event.target.files);
            const previewContainer = document.getElementById('foundImagePreview');
            previewContainer.innerHTML = '';

            files.forEach((file, index) => {
                if (file.size > 5 * 1024 * 1024) {
                    showToast(`File ${file.name} is too large (max 5MB)`, 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const imgSrc = e.target.result;
                    foundImages.push(imgSrc);

                    const preview = document.createElement('div');
                    preview.className = 'image-preview';
                    preview.innerHTML = `
                        <img src="${imgSrc}" alt="Preview ${index + 1}">
                        <button type="button" class="remove-image" onclick="removeFoundImage(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    previewContainer.appendChild(preview);
                };
                reader.readAsDataURL(file);
            });
        }

        function removeLostImage(index) {
            lostImages.splice(index, 1);
            updateImagePreview('lost');
        }

        function removeFoundImage(index) {
            foundImages.splice(index, 1);
            updateImagePreview('found');
        }

        function updateImagePreview(type) {
            const previewContainer = document.getElementById(`${type}ImagePreview`);
            const images = type === 'lost' ? lostImages : foundImages;

            previewContainer.innerHTML = '';

            images.forEach((imgSrc, index) => {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
                    <img src="${imgSrc}" alt="Preview ${index + 1}">
                    <button type="button" class="remove-image" onclick="remove${type.charAt(0).toUpperCase() + type.slice(1)}Image(${index})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                previewContainer.appendChild(preview);
            });
        }

        // ===== TOGGLE SECTIONS =====
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const header = section.previousElementSibling;
            const icon = header.querySelector('.toggle-icon');

            section.classList.toggle('active');
            header.classList.toggle('active');

            if (section.classList.contains('active')) {
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');

                if (sectionId === 'lostContainer' && allItems.lost.length === 0) {
                    loadItems();
                } else if (sectionId === 'foundContainer' && allItems.found.length === 0) {
                    loadItems();
                } else if (sectionId === 'matchedContainer' && allItems.matched.length === 0) {
                    loadItems();
                }
            } else {
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        // ===== DATA MANAGEMENT =====
        async function loadItems() {
            try {
                document.getElementById('lostList').innerHTML = '<div class="spinner-container"><div class="spinner"></div></div>';
                document.getElementById('foundList').innerHTML = '<div class="spinner-container"><div class="spinner"></div></div>';
                document.getElementById('matchedList').innerHTML = '<div class="spinner-container"><div class="spinner"></div></div>';

                // Load all lost items
                const lostSnapshot = await db.collection('lostItems')
                    .orderBy('timestamp', 'desc')
                    .get();
                allItems.lost = lostSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Load all found items
                const foundSnapshot = await db.collection('foundItems')
                    .orderBy('timestamp', 'desc')
                    .get();
                allItems.found = foundSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                // Load all matched items
                const matchedSnapshot = await db.collection('matchedItems')
                    .orderBy('matchedAt', 'desc')
                    .get();
                allItems.matched = matchedSnapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                renderLists();
                updateStats();

            } catch (error) {
                console.error('Error loading items:', error);
                showToast('Failed to load items. Please refresh the page.', 'error');
                renderLists();
            }
        }

        function renderLists() {
            renderList('lost');
            renderList('found');
            renderList('matched');
        }

        function renderList(type) {
            const container = document.getElementById(`${type}List`);
            const items = allItems[type];

            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-${type === 'lost' ? 'exclamation-triangle' : type === 'found' ? 'check-circle' : 'handshake'}"></i>
                        <h3>No ${type} items found</h3>
                        <p>${type === 'matched' ? 'No items have been successfully matched yet.' : 'Be the first to report a ' + type + ' item!'}</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = items.map(item => createItemCard(item, type)).join('');
        }

        // ===== HELPER FUNCTION TO CHECK ITEM OWNERSHIP =====
        function isItemOwner(item) {
            if (!currentUser) return false;
            
            // Check multiple ways to determine ownership for backward compatibility
            if (item.userId && item.userId === currentUser.userId) return true;
            if (item.userEmail && item.userEmail === currentUser.email) return true;
            if (item.email && item.email === currentUser.email) return true;
            
            // For backward compatibility, also check if the name matches
            if (item.name && item.name === currentUser.name) return true;
            
            return false;
        }

        function createItemCard(item, type) {
            const isLost = type === 'lost' || (type === 'matched' && item.originalType === 'lost');
            const isFound = type === 'found' || (type === 'matched' && item.originalType === 'found');
            const isMatched = type === 'matched';
            const isOwner = isItemOwner(item);
            const date = new Date(item.date || item.timestamp?.toDate());
            const formattedDate = date.toLocaleDateString('en-US', {
                weekday: 'short',
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });

            const categoryLabels = {
                electronics: 'üì± Electronics',
                documents: 'üìÑ Documents/ID Cards',
                stationery: '‚úèÔ∏è Stationery',
                clothing: 'üëï Clothing',
                keys: 'üîë Keys',
                bag: 'üéí Bag/Backpack',
                books: 'üìö Books/Notebooks',
                other: 'üì¶ Other'
            };

            // Determine contact information to display
            const contactEmail = item.email || item.userEmail || 'No email provided';
            const contactPhone = item.phone || 'No phone provided';

            // Determine badge colors
            let badgeClass = '';
            let badgeText = '';
            if (isMatched) {
                badgeClass = 'badge-matched';
                badgeText = 'MATCHED';
            } else if (isLost) {
                badgeClass = 'badge-lost';
                badgeText = 'LOST';
            } else if (isFound) {
                badgeClass = 'badge-found';
                badgeText = 'FOUND';
            }

            return `
                <div class="item-card ${isMatched ? 'matched' : (isLost ? 'lost' : 'found')}" data-id="${item.id}">
                    <div class="item-header">
                        <div>
                            <h3 class="item-title">${escapeHtml(item.item)}</h3>
                            ${item.userName ? `
                                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 5px;">
                                    <i class="fas fa-user"></i> Reported by: ${escapeHtml(item.userName)}
                                    ${isOwner ? '<span class="owner-badge">Your Item</span>' : ''}
                                </p>
                            ` : ''}
                            ${isMatched ? `
                                <p style="font-size: 0.85rem; color: ${isLost ? 'var(--warning-color)' : 'var(--success-color)'}; margin-top: 5px;">
                                    <i class="fas fa-${isLost ? 'exclamation-triangle' : 'check-circle'}"></i>
                                    Originally reported as ${isLost ? 'LOST' : 'FOUND'}
                                </p>
                            ` : ''}
                        </div>
                        <div>
                            <span class="item-badge ${badgeClass}">${badgeText}</span>
                        </div>
                    </div>
                    
                    <div class="item-meta">
                        <span><i class="fas fa-tag"></i> ${categoryLabels[item.category] || 'üì¶ Other'}</span>
                        <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                        ${item.time ? `<span><i class="fas fa-clock"></i> ${item.time}</span>` : ''}
                    </div>
                    
                    ${item.location ? `<p><i class="fas fa-map-marker-alt"></i> ${escapeHtml(item.location)}</p>` : ''}
                    
                    ${item.description ? `<p>${escapeHtml(item.description)}</p>` : ''}
                    
                    ${item.color || item.brand ? `
                        <div class="item-meta">
                            ${item.color ? `<span><i class="fas fa-palette"></i> ${escapeHtml(item.color)}</span>` : ''}
                            ${item.brand ? `<span><i class="fas fa-tag"></i> ${escapeHtml(item.brand)}</span>` : ''}
                        </div>
                    ` : ''}
                    
                    ${item.imageUrl ? `
                        <img src="${item.imageUrl}" alt="${escapeHtml(item.item)}" class="item-image">
                    ` : ''}
                    
                    <div class="item-meta">
                        <span><i class="fas fa-user"></i> ${escapeHtml(item.name)}</span>
                        <span><i class="fas fa-envelope"></i> ${escapeHtml(contactEmail)}</span>
                        ${contactPhone !== 'No phone provided' ? `<span><i class="fas fa-phone"></i> ${escapeHtml(contactPhone)}</span>` : ''}
                    </div>
                    
                    ${isMatched && item.matchedWith ? `
                        <div style="margin-top: 10px; padding: 10px; background: rgba(90, 103, 216, 0.1); 
                                    border-radius: var(--border-radius-sm); color: var(--primary-color);">
                            <i class="fas fa-handshake"></i> Successfully matched with: ${escapeHtml(item.matchedWith)}
                        </div>
                    ` : ''}
                    
                    <div class="item-actions">
                        ${isOwner ? `
                            ${!isMatched && !item.matched ? `
                                <button class="btn btn-outline btn-icon" onclick="markAsMatched('${type}', '${item.id}')" 
                                        title="Mark as Matched">
                                    <i class="fas fa-handshake"></i>
                                </button>
                                <button class="btn btn-outline btn-icon" onclick="editItem('${type}', '${item.id}')" 
                                        title="Edit Item">
                                    <i class="fas fa-edit"></i>
                                </button>
                            ` : ''}
                            <button class="btn btn-outline btn-icon" onclick="deleteItem('${isMatched ? 'matched' : type}', '${item.id}')" 
                                    title="Delete Item">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : !isMatched ? `
                            <button class="btn btn-outline" onclick="claimItem('${type}', '${item.id}')">
                                <i class="fas fa-${isLost ? 'hand-holding' : 'flag'}"></i> ${isLost ? 'I think I found this' : 'I think this is mine'}
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function initializeEmptyStates() {
            ['lostList', 'foundList', 'matchedList'].forEach(id => {
                const container = document.getElementById(id);
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>Loading items...</h3>
                    </div>
                `;
            });
        }

        // ===== FORM SUBMISSION =====
        async function handleLostFormSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            submitBtn.disabled = true;

            try {
                const formData = {
                    name: escapeHtml(document.getElementById('lName').value.trim()),
                    email: escapeHtml(document.getElementById('lEmail').value.trim().toLowerCase()),
                    phone: escapeHtml(document.getElementById('lPhone').value.trim()),
                    item: escapeHtml(document.getElementById('lItem').value.trim()),
                    category: document.getElementById('lCategory').value,
                    date: document.getElementById('lDate').value,
                    time: document.getElementById('lTime').value,
                    location: escapeHtml(document.getElementById('lLoc').value.trim()),
                    description: escapeHtml(document.getElementById('lDesc').value.trim()),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: currentUser.userId,
                    userName: currentUser.name,
                    userUsername: currentUser.username,
                    userEmail: currentUser.email,
                    matched: false
                };

                if (lostImages.length > 0) {
                    formData.imageUrl = lostImages[0];
                    if (lostImages.length > 1) {
                        formData.additionalImages = lostImages.slice(1);
                    }
                }

                const docRef = await db.collection('lostItems').add(formData);
                allItems.lost.unshift({ id: docRef.id, ...formData });

                form.reset();
                document.getElementById('lDate').valueAsDate = new Date();
                lostImages = [];
                document.getElementById('lostImagePreview').innerHTML = '';

                renderLists();
                updateStats();
                showToast('Lost item reported successfully!', 'success');

                if (!document.getElementById('lostContainer').classList.contains('active')) {
                    toggleSection('lostContainer');
                }

            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to submit. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function handleFoundFormSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            submitBtn.disabled = true;

            try {
                const formData = {
                    name: escapeHtml(document.getElementById('fName').value.trim()),
                    email: escapeHtml(document.getElementById('fEmail').value.trim().toLowerCase()),
                    phone: escapeHtml(document.getElementById('fPhone').value.trim()),
                    organization: escapeHtml(document.getElementById('fOrganization').value.trim()),
                    item: escapeHtml(document.getElementById('fItem').value.trim()),
                    category: document.getElementById('fCategory').value,
                    condition: document.getElementById('fCondition').value,
                    date: document.getElementById('fDate').value,
                    time: document.getElementById('fTime').value,
                    location: escapeHtml(document.getElementById('fLoc').value.trim()),
                    description: escapeHtml(document.getElementById('fDesc').value.trim()),
                    color: escapeHtml(document.getElementById('fColor').value.trim()),
                    brand: escapeHtml(document.getElementById('fBrand').value.trim()),
                    model: escapeHtml(document.getElementById('fModel').value.trim()),
                    storage: document.getElementById('fStorage').value,
                    availability: escapeHtml(document.getElementById('fAvailability').value.trim()),
                    notes: escapeHtml(document.getElementById('fNotes').value.trim()),
                    anonymous: document.getElementById('fAnonymous').checked,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: currentUser.userId,
                    userName: currentUser.name,
                    userUsername: currentUser.username,
                    userEmail: currentUser.email,
                    matched: false
                };

                if (foundImages.length > 0) {
                    formData.imageUrl = foundImages[0];
                    if (foundImages.length > 1) {
                        formData.additionalImages = foundImages.slice(1);
                    }
                }

                const docRef = await db.collection('foundItems').add(formData);
                allItems.found.unshift({ id: docRef.id, ...formData });

                form.reset();
                document.getElementById('fDate').valueAsDate = new Date();
                foundImages = [];
                document.getElementById('foundImagePreview').innerHTML = '';
                goToStep(1);

                renderLists();
                updateStats();
                showToast('Found item reported successfully!', 'success');

                if (!document.getElementById('foundContainer').classList.contains('active')) {
                    toggleSection('foundContainer');
                }

            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to submit. Please try again.', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // ===== ITEM MANAGEMENT =====
        async function deleteItem(type, id) {
            if (!currentUser) {
                showToast('Please login to delete items.', 'error');
                return;
            }

            try {
                let dbCollection;
                switch(type) {
                    case 'lost':
                        dbCollection = db.collection('lostItems');
                        break;
                    case 'found':
                        dbCollection = db.collection('foundItems');
                        break;
                    case 'matched':
                        dbCollection = db.collection('matchedItems');
                        break;
                    default:
                        showToast('Invalid item type.', 'error');
                        return;
                }

                const itemRef = dbCollection.doc(id);
                const itemDoc = await itemRef.get();

                if (!itemDoc.exists) {
                    showToast('Item not found.', 'error');
                    return;
                }

                const itemData = itemDoc.data();

                // Check ownership using the same method as in createItemCard
                if (!isItemOwner(itemData)) {
                    showToast('You can only delete your own items.', 'error');
                    return;
                }

                // Confirm deletion
                if (!confirm('Are you sure you want to delete this item?')) {
                    return;
                }

                // Delete from Firestore
                await itemRef.delete();

                // Remove from local arrays
                const allItemsArray = allItems[type];
                const itemIndex = allItemsArray.findIndex(item => item.id === id);
                if (itemIndex !== -1) {
                    allItemsArray.splice(itemIndex, 1);
                }

                // Update UI
                renderLists();
                updateStats();
                showToast('Item deleted successfully.', 'success');

            } catch (error) {
                console.error('Error deleting item:', error);
                showToast('Failed to delete item. Please try again.', 'error');
            }
        }

        function editItem(type, id) {
            if (!currentUser) {
                showToast('Please login to edit items.', 'error');
                return;
            }

            const items = type === 'lost' ? allItems.lost : allItems.found;
            const item = items.find(i => i.id === id);

            if (!item) return;

            // Check ownership
            if (!isItemOwner(item)) {
                showToast('You can only edit your own items.', 'error');
                return;
            }

            currentEditId = id;
            currentEditType = type;

            document.getElementById('editItem').value = item.item;
            document.getElementById('editCategory').value = item.category || 'other';
            document.getElementById('editDate').value = item.date || 
                (item.timestamp?.toDate().toISOString().split('T')[0]);
            document.getElementById('editLocation').value = item.location || '';
            document.getElementById('editEmail').value = item.email || item.userEmail || '';
            document.getElementById('editPhone').value = item.phone || '';
            document.getElementById('editDesc').value = item.description || '';

            document.getElementById('editModal').style.display = 'flex';
        }

        async function handleEditSubmit(event) {
            event.preventDefault();

            try {
                const updatedData = {
                    item: escapeHtml(document.getElementById('editItem').value.trim()),
                    category: document.getElementById('editCategory').value,
                    date: document.getElementById('editDate').value,
                    location: escapeHtml(document.getElementById('editLocation').value.trim()),
                    email: escapeHtml(document.getElementById('editEmail').value.trim()),
                    phone: escapeHtml(document.getElementById('editPhone').value.trim()),
                    description: escapeHtml(document.getElementById('editDesc').value.trim()),
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };

                const dbCollection = currentEditType === 'lost' ? db.collection('lostItems') : db.collection('foundItems');
                const itemRef = dbCollection.doc(currentEditId);
                const itemDoc = await itemRef.get();

                if (!itemDoc.exists) {
                    showToast('Item not found.', 'error');
                    return;
                }

                const itemData = itemDoc.data();
                
                // Check ownership
                if (!isItemOwner(itemData)) {
                    showToast('You can only edit your own items.', 'error');
                    return;
                }

                await itemRef.update(updatedData);

                // Update local array
                const collection = currentEditType === 'lost' ? allItems.lost : allItems.found;
                const index = collection.findIndex(item => item.id === currentEditId);
                if (index !== -1) {
                    collection[index] = { ...collection[index], ...updatedData };
                }

                closeModal();
                renderLists();
                showToast('Item updated successfully!', 'success');

            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to update item.', 'error');
            }
        }

        async function markAsMatched(type, id) {
            try {
                const dbCollection = type === 'lost' ? db.collection('lostItems') : db.collection('foundItems');
                await dbCollection.doc(id).update({
                    matched: true,
                    matchedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Update local array
                const collection = type === 'lost' ? allItems.lost : allItems.found;
                const item = collection.find(i => i.id === id);
                if (item) {
                    item.matched = true;
                    item.matchedAt = new Date().toISOString();
                }

                showToast('Item marked as matched!', 'success');
                renderLists();
                updateStats();
            } catch (error) {
                console.error('Error:', error);
                showToast('Failed to mark as matched.', 'error');
            }
        }

        // ===== CLAIM ITEM FUNCTIONALITY =====
        async function claimItem(type, id) {
            const items = type === 'lost' ? allItems.lost : allItems.found;
            const item = items.find(i => i.id === id);

            if (!item) {
                showToast('Item not found.', 'error');
                return;
            }

            if (!currentUser) {
                showToast('Please login to claim items.', 'error');
                return;
            }

            // Check if user is claiming their own item
            if (isItemOwner(item)) {
                showToast('This is your own item!', 'info');
                return;
            }

            // Show confirmation dialog
            const confirmation = confirm(`Are you sure you want to claim this item as ${type === 'lost' ? 'found' : 'yours'}? This will move it to the matched items section.`);
            
            if (!confirmation) {
                showToast('Claim cancelled.', 'info');
                return;
            }

            try {
                // Prepare matched item data
                const matchedItemData = {
                    ...item,
                    matchedWith: currentUser.name,
                    matchedWithEmail: currentUser.email,
                    matchedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    originalType: type
                };

                // Add to matched items collection
                const matchedRef = await db.collection('matchedItems').add(matchedItemData);
                
                // Remove from original collection
                const originalCollection = type === 'lost' ? db.collection('lostItems') : db.collection('foundItems');
                await originalCollection.doc(id).delete();

                // Update local arrays
                const originalItemsArray = type === 'lost' ? allItems.lost : allItems.found;
                const originalIndex = originalItemsArray.findIndex(i => i.id === id);
                if (originalIndex !== -1) {
                    originalItemsArray.splice(originalIndex, 1);
                }

                // Add to matched items
                allItems.matched.unshift({ id: matchedRef.id, ...matchedItemData });

                // Send email notification
                const claimerDetails = {
                    name: currentUser.name,
                    email: currentUser.email,
                    phone: currentUser.phone || 'Not provided'
                };

                const recipientEmail = item.email || item.userEmail;
                const recipientName = item.name || item.userName || 'User';

                if (recipientEmail) {
                    await sendNotificationEmail(
                        recipientEmail,
                        recipientName,
                        item,
                        claimerDetails,
                        type
                    );
                }

                // Update UI
                renderLists();
                updateStats();
                showToast('Item claimed successfully! Moved to matched items.', 'success');

                // Open matched section if not open
                if (!document.getElementById('matchedContainer').classList.contains('active')) {
                    toggleSection('matchedContainer');
                }

            } catch (error) {
                console.error('Error claiming item:', error);
                showToast('Failed to claim item. Please try again.', 'error');
            }
        }

        // ===== UNMATCH ITEM FUNCTIONALITY =====
        async function unmatchItem(id) {
            if (!currentUser) {
                showToast('Please login to manage items.', 'error');
                return;
            }

            const item = allItems.matched.find(i => i.id === id);
            if (!item) {
                showToast('Item not found.', 'error');
                return;
            }

            // Check ownership
            if (!isItemOwner(item)) {
                showToast('You can only return your own items to the original list.', 'error');
                return;
            }

            const confirmation = confirm('Are you sure you want to return this item to its original list?');
            if (!confirmation) return;

            try {
                // Remove from matched items
                await db.collection('matchedItems').doc(id).delete();

                // Prepare data for original collection
                const { matchedWith, matchedWithEmail, matchedAt, originalType, id: oldId, ...originalItemData } = item;

                // Add back to original collection
                const originalCollection = item.originalType === 'lost' ? 'lostItems' : 'foundItems';
                const originalRef = db.collection(originalCollection);
                const docRef = await originalRef.add({
                    ...originalItemData,
                    matched: false
                });

                // Update local arrays
                const matchedIndex = allItems.matched.findIndex(i => i.id === id);
                if (matchedIndex !== -1) {
                    allItems.matched.splice(matchedIndex, 1);
                }

                const newItem = { id: docRef.id, ...originalItemData, matched: false };
                if (item.originalType === 'lost') {
                    allItems.lost.unshift(newItem);
                } else {
                    allItems.found.unshift(newItem);
                }

                renderLists();
                updateStats();
                showToast('Item returned to original list.', 'success');

            } catch (error) {
                console.error('Error unmatching item:', error);
                showToast('Failed to return item. Please try again.', 'error');
            }
        }

        // ===== SEARCH AND FILTER =====
        function debounceFilter(type) {
            const searchInput = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const searchTerm = searchInput.value;
            
            showSearchSuggestions(type, searchTerm);
            
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => filterItems(type), 300);
        }

        function filterItems(type, category = null) {
            const searchInput = document.getElementById(`search${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const searchTerm = searchInput.value.toLowerCase();

            if (category && event) {
                document.querySelectorAll(`#${type}Container .filter-btn`).forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
            }

            const items = (type === 'lost' ? allItems.lost : 
                          type === 'found' ? allItems.found : 
                          allItems.matched).filter(item => {
                if (category === 'matched') {
                    return item.matched === true;
                }

                if (category && category !== 'all' && item.category !== category) {
                    return false;
                }

                if (!searchTerm) return true;

                const searchFields = [
                    item.item,
                    item.category,
                    item.location,
                    item.description,
                    item.name,
                    item.color,
                    item.brand,
                    item.model
                ].filter(Boolean).map(f => f.toLowerCase());

                return searchFields.some(field => field.includes(searchTerm));
            });

            const container = document.getElementById(`${type}List`);
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No items found</h3>
                        <p>Try adjusting your search or filter criteria</p>
                    </div>
                `;
            } else {
                container.innerHTML = items.map(item => createItemCard(item, type)).join('');
            }
        }

        // ===== MATCHED ITEMS FUNCTIONALITY =====
        function showMatchedItems() {
            // Open matched section
            const matchedContainer = document.getElementById('matchedContainer');
            if (!matchedContainer.classList.contains('active')) {
                toggleSection('matchedContainer');
            }
            
            // Clear search box
            document.getElementById('searchMatched').value = '';
            
            // Filter to show all matched items
            filterItems('matched', 'all');
            
            // Scroll to the matched section
            setTimeout(() => {
                scrollToSection('matchedContainer');
            }, 300);
            
            showToast('Showing all matched items', 'info');
        }

        function filterMatchedItems() {
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show matched items in lost and found sections
            const matchedLostItems = allItems.lost.filter(item => item.matched === true);
            const matchedFoundItems = allItems.found.filter(item => item.matched === true);
            
            renderFilteredItems('lost', matchedLostItems);
            renderFilteredItems('found', matchedFoundItems);
            
            if (matchedLostItems.length === 0 && matchedFoundItems.length === 0) {
                showToast('No matched items found in lost/found sections.', 'info');
            }
        }

        function renderFilteredItems(type, items) {
            const container = document.getElementById(`${type}List`);
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-handshake"></i>
                        <h3>No matched ${type} items</h3>
                        <p>No ${type} items have been marked as matched yet.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = items.map(item => createItemCard(item, type)).join('');
        }

        // ===== STATS MANAGEMENT =====
        function updateStats() {
            stats.lost = allItems.lost.length;
            stats.found = allItems.found.length;
            stats.matched = allItems.matched.length;

            document.getElementById('lostCount').textContent = stats.lost;
            document.getElementById('foundCount').textContent = stats.found;
            document.getElementById('matchedCount').textContent = stats.matched;
        }

        // ===== MODAL MANAGEMENT =====
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
            currentEditId = null;
            currentEditType = null;
        }

        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // ===== INFORMATION MODALS =====
        function showQuickGuide() {
            showToast('Quick Guide: Report lost/found items. Only you can edit/delete your items. Browse items in expandable sections.', 'info', 8000);
        }

        function showPrivacyPolicy() {
            showToast('Privacy Policy: Your data is secure. We only store necessary information.', 'info', 8000);
        }

        function showContact() {
            showToast('Contact: Email: mithunsabari17@gmail.com', 'info', 8000);
        }

        function showAbout() {
            showToast('Back2You: College Lost & Found Management System. Developed by Team Nexus.', 'info', 8000);
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                document.getElementById('searchLost').focus();
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                toggleDarkMode();
            }
        });

        // ===== SCROLL FUNCTIONS =====
        function scrollToSection(sectionId) {
            const header = document.querySelector(`#${sectionId}`).previousElementSibling;
            if (header) {
                const content = document.getElementById(sectionId);
                if (!content.classList.contains('active')) {
                    toggleSection(sectionId);
                }
                header.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
    </script>
</body>
</html>
